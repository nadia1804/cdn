<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabel Data dari Google Sheet</title>
    <!-- Bootstrap CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        /* CSS Kustom untuk Sticky Header dan Kolom Pertama, serta Responsivitas */

        /* Kelas untuk styling body */
        .app-body-style {
            font-family: 'Inter', sans-serif;
            font-size: 15px; /* Ukuran font default untuk desktop, sedikit lebih kecil */
            background-color: #f8f9fa; /* Bootstrap's light background */
            padding: 0;
            margin: 0;
        }

        /* Kelas untuk membuat header tabel lengket (sticky) */
        .sticky-header-th {
            position: sticky;
            top: 0;
            background-color: #f9fafb; /* Warna latar belakang light gray */
            color: #212529; /* Warna teks gelap (Bootstrap default text-dark) */
            z-index: 10; /* Pastikan di atas konten lain saat scroll */
            box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.1); /* Sedikit bayangan untuk efek elevasi */
        }

        /* Kelas untuk membuat kolom pertama lengket (sticky) */
        .sticky-first-col {
            position: sticky;
            left: 0;
            background-color: #f9fafb; /* Warna latar belakang light gray */
            z-index: 11; /* Lebih tinggi dari header agar tumpang tindih dengan benar */
            box-shadow: 2px 0 2px -1px rgba(0, 0, 0, 0.1); /* Sedikit bayangan untuk efek elevasi */
        }

        /* Menyesuaikan z-index untuk sudut persimpangan header dan kolom pertama */
        .sticky-header-th.sticky-first-col {
            z-index: 12; /* Paling tinggi agar selalu terlihat di sudut */
            background-color: #f9fafb; /* Pastikan sudut juga light gray */
            color: #212529; /* Pastikan teks sudut juga gelap */
        }

        /* Pastikan kontainer tabel memiliki scrollbar dan sel tidak terpotong oleh sticky positioning */
        .table-scroll-container {
            max-height: 80vh; /* Batasi tinggi kontainer agar scrollbar muncul */
            overflow: auto; /* Aktifkan scrolling di kontainer */
        }

        /* Kelas untuk tabel dengan garis atas dan bawah saja (Dihapus karena sekarang ingin semua garis) */
        /* .table-top-bottom-border {
            border-top: 1px solid #dee2e6;
            border-bottom: 1px solid #dee2e6;
        } */

        /* Media Queries untuk Responsivitas (menggunakan breakpoint Bootstrap) */
        /* Small devices (potrait tablets and large phones, 576px and up) */
        @media (max-width: 767.98px) { /* Equivalent to Bootstrap's sm breakpoint */
            .app-body-style {
                font-size: 13px; /* Perkecil ukuran font dasar */
            }
            .main-content-wrapper { /* Menggunakan kelas baru untuk wrapper utama */
                padding: 1rem; /* Kurangi padding kontainer */
            }
            .display-4 { /* Untuk h1 */
                font-size: 2rem; /* Perkecil ukuran judul */
            }
            /* Kelas untuk padding sel tabel responsif (Bootstrap table-sm akan menyesuaikan juga) */
            .table-cell-padding-responsive { 
                padding: 0.5rem 0.75rem !important; 
                font-size: 0.75rem !important; 
            }
        }

        /* Extra small devices (phones, less than 576px) */
        @media (max-width: 575.98px) { /* Equivalent to Bootstrap's xs breakpoint */
            .app-body-style {
                font-size: 11px; /* Perkecil ukuran font dasar lebih lanjut */
            }
            .main-content-wrapper { /* Menggunakan kelas baru untuk wrapper utama */
                padding: 0.75rem; /* Kurangi padding kontainer lebih lanjut */
            }
            .display-4 { /* Untuk h1 */
                font-size: 1.75rem; /* Perkecil ukuran judul lebih lanjut */
            }
            /* Kelas untuk padding sel tabel responsif (Bootstrap table-sm akan menyesuaikan juga) */
            .table-cell-padding-responsive { 
                padding: 0.4rem 0.6rem !important; 
                font-size: 0.7rem !important; 
            }
            /* Pastikan kolom pertama sticky tetap terlihat */
            .sticky-first-col {
                min-width: 80px; /* Atur lebar minimum agar tidak terlalu kecil */
            }
        }
    </style>
</head>
<body class="app-body-style">
    <!-- Mengubah div container menjadi div fullwidth dengan padding -->
    <div class="main-content-wrapper bg-white p-4 p-md-5 rounded shadow-lg mx-auto" style="max-width: 96%; margin-top: 2rem; margin-bottom: 2rem;">
        
        <!-- Indikator loading saat data sedang dimuat -->
        <div id="loading" class="text-center text-muted mb-3">Memuat data...</div>

        <!-- Fitur Pencarian Teks -->
        <div class="mb-3">
            <label for="searchInput" class="form-label visually-hidden">Cari Teks:</label>
            <input type="text" class="form-control" id="searchInput" placeholder="Cari di tabel..." onkeyup="filterTable()">
        </div>

        <!-- Kontainer tabel, akan diisi oleh JavaScript -->
        <div id="table-container" class="table-responsive border rounded table-scroll-container">
            <!-- Elemen tabel HTML. ID 'data-table' hanya untuk identifikasi DOM,
                 script tidak perlu tahu 'nama tabel' dari spreadsheet. -->
            <table id="data-table" class="table table-hover table-sm mb-0 table-bordered"> <!-- Added table-bordered class -->
                <thead class="bg-light">
                    <tr id="table-header">
                        <!-- Header tabel akan diisi secara dinamis oleh JavaScript -->
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Baris data akan diisi secara dinamis oleh JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Pesan error jika terjadi masalah saat memuat data -->
        <div id="error-message" class="d-none text-center text-danger mt-3">
            Terjadi kesalahan saat memuat data. Pastikan URL Google Sheet benar dan dipublikasikan.
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        // =====================================================================
        // PENTING: Konfigurasi URL Google Sheet Anda di sini!
        // =====================================================================
        // Ganti 'YOUR_SHEET_ID_HERE' dengan ID unik dari Google Sheet Anda.
        // ID ini adalah bagian dari URL spreadsheet Anda setelah '/d/' dan sebelum '/pub'.
        // Contoh: https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID_HERE/edit#gid=0
        const GOOGLE_SHEET_ID = '2PACX-1vQk28bM2xkHw7YKmd0Y-37QL0TSpdmF-UWzv1X84tPmi2e3xwJqfiusvB8h4W7u8A';

        // Ganti 'YOUR_GID_HERE' dengan ID dari sheet spesifik yang ingin Anda tampilkan.
        // Setiap tab (sheet) dalam Google Sheet memiliki GID unik.
        // Anda bisa menemukannya di URL browser saat Anda membuka tab sheet tersebut (setelah '#gid=').
        // Contoh: https://docs.google.com/spreadsheets/d/.../edit#gid=YOUR_GID_HERE
        const GOOGLE_SHEET_GID = '1515080016';

        // URL lengkap untuk mengambil data TSV dari Google Sheet yang dipublikasikan.
        // Jangan ubah bagian ini, cukup ubah GOOGLE_SHEET_ID dan GOOGLE_SHEET_GID di atas.
        const GOOGLE_SHEET_TSV_URL = `https://docs.google.com/spreadsheets/d/e/${GOOGLE_SHEET_ID}/pub?gid=${GOOGLE_SHEET_GID}&single=true&output=tsv`;
        // =====================================================================

        // Mendapatkan referensi ke elemen-elemen HTML yang akan dimanipulasi
        const loadingElement = document.getElementById('loading');
        const tableContainer = document.getElementById('table-container');
        const tableHeaderRow = document.getElementById('table-header'); 
        const tableBody = document.getElementById('table-body');   
        const errorMessage = document.getElementById('error-message');
        const dataTable = document.getElementById('data-table');
        const searchInput = document.getElementById('searchInput'); // Referensi ke input pencarian

        /**
         * Fungsi untuk menyaring baris tabel berdasarkan teks input pencarian.
         */
        window.filterTable = function() { // Dibuat global agar bisa dipanggil dari onkeyup
            const filter = searchInput.value.toLowerCase();
            const rows = tableBody.getElementsByTagName('tr');

            for (let i = 0; i < rows.length; i++) {
                let rowVisible = false;
                const cells = rows[i].getElementsByTagName('td');
                for (let j = 0; j < cells.length; j++) {
                    const cellText = cells[j].textContent || cells[j].innerText;
                    if (cellText.toLowerCase().indexOf(filter) > -1) {
                        rowVisible = true;
                        break;
                    }
                }
                rows[i].style.display = rowVisible ? '' : 'none';
            }
        }

        /**
         * Fungsi asinkron untuk mengambil data dari Google Sheet dan merender tabel HTML.
         * Fungsi ini tidak memerlukan 'nama tabel' spesifik dari spreadsheet,
         * hanya URL data TSV.
         */
        async function fetchDataAndRenderTable() {
            loadingElement.classList.remove('d-none'); // Tampilkan indikator loading
            tableContainer.classList.add('d-none');   // Sembunyikan tabel sementara
            errorMessage.classList.add('d-none');     // Sembunyikan pesan error

            try {
                // Mengambil data dari URL Google Sheet
                const response = await fetch(GOOGLE_SHEET_TSV_URL);

                // Memeriksa apakah respons HTTP berhasil
                if (!response.ok) {
                    throw new Error(`Kesalahan HTTP! status: ${response.status}`);
                }

                // Mengambil teks TSV dari respons
                const tsvText = await response.text();
                // Memisahkan teks TSV menjadi baris-baris
                const rows = tsvText.trim().split('\n'); 
                
                // Memeriksa jika tidak ada data yang ditemukan
                if (rows.length === 0) {
                    throw new Error('Tidak ada data yang ditemukan di Google Sheet.');
                }

                // Baris pertama TSV dianggap sebagai header tabel, dipisahkan oleh tab
                const headers = rows[0].split('\t').map(header => header.trim()); 
                // Sisa baris adalah data tabel, dipisahkan oleh tab
                const dataRows = rows.slice(1); 

                // Mengisi header tabel secara dinamis
                tableHeaderRow.innerHTML = ''; // Bersihkan header sebelumnya
                headers.forEach((header, index) => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    // Kelas Bootstrap untuk styling header: tebal, rata kiri, tengah vertikal, uppercase, kecil
                    // Warna teks diatur oleh CSS kustom .sticky-header-th
                    th.classList.add('p-2', 'text-start', 'align-middle', 'text-uppercase', 'small', 'fw-bold');
                    
                    // Tambahkan kelas khusus untuk kolom pertama agar bisa disticky
                    if (index === 0) {
                        th.classList.add('sticky-first-col'); 
                    }
                    // Tambahkan kelas sticky header untuk semua th
                    th.classList.add('sticky-header-th');
                    tableHeaderRow.appendChild(th);
                });

                // Mengisi baris data tabel secara dinamis
                tableBody.innerHTML = ''; // Bersihkan body tabel sebelumnya
                dataRows.forEach(rowData => {
                    const values = rowData.split('\t').map(value => value.trim()); 
                    const tr = document.createElement('tr');

                    values.forEach((value, index) => {
                        const td = document.createElement('td');
                        td.textContent = value;
                        // Kelas Bootstrap untuk styling sel data: rata kiri, tengah vertikal
                        td.classList.add('p-3', 'text-nowrap', 'text-start', 'align-middle'); 
                        // Tambahkan kelas khusus untuk kolom pertama agar bisa disticky
                        if (index === 0) {
                            td.classList.add('text-dark', 'sticky-first-col'); 
                        }
                        tr.appendChild(td);
                    });
                    tableBody.appendChild(tr);
                });

                loadingElement.classList.add('d-none');     // Sembunyikan loading
                tableContainer.classList.remove('d-none'); // Tampilkan tabel

            } catch (error) {
                console.error('Gagal memuat data dari Google Sheet:', error);
                loadingElement.classList.add('d-none'); // Sembunyikan loading
                errorMessage.classList.remove('d-none'); // Tampilkan pesan error
            }
        }

        // Panggil fungsi untuk mengambil dan merender tabel saat halaman HTML selesai dimuat
        window.onload = fetchDataAndRenderTable;
    </script>
</body>
</html>
